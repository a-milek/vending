asyncapi: "2.0.0"
info:
  title: MDB Coin Changer WebSocket API
  version: "1.0.0"
  description: |
    WebSocket interface between the MDB Serial Bridge / Payment Service and the React frontend.

servers:
  wsServer:
    url: ws://192.168.56.1:9000
    protocol: ws

channels:
  # Oddzielne kanały dla każdej komendy
  coinChanger/commands/reset:
    description: Reset command to the coin changer
    publish:
      message:
        $ref: "#/components/messages/ResetCommand"

  coinChanger/commands/identify:
    description: Identify command to the coin changer
    publish:
      message:
        $ref: "#/components/messages/IdentifyCommand"

  coinChanger/commands/enable:
    description: Enable command to the coin changer
    publish:
      message:
        $ref: "#/components/messages/EnableCommand"

  coinChanger/commands/disable:
    description: Disable command to the coin changer
    publish:
      message:
        $ref: "#/components/messages/DisableCommand"

  coinChanger/commands/spend:
    description: Spend command to the coin changer
    publish:
      message:
        $ref: "#/components/messages/SpendCommand"

  coinChanger/commands/dispense:
    description: Dispense command to the coin changer
    publish:
      message:
        $ref: "#/components/messages/DispenseCommand"

  coinChanger/commands/configureCoin:
    description: Configure coin command to the coin changer
    publish:
      message:
        $ref: "#/components/messages/ConfigureCoinCommand"

  coinChanger/commands/configureFeatures:
    description: Configure features command to the coin changer
    publish:
      message:
        $ref: "#/components/messages/ConfigureFeaturesCommand"

  coinChanger/events:
    description: Events from the coin changer
    subscribe:
      message:
        $ref: "#/components/messages/WsMessage"

components:
  messages:
    ResetCommand:
      name: ResetCommand
      title: Reset
      payload:
        type: object
        properties:
          action:
            const: reset
            description: Reset the coin changer.

    IdentifyCommand:
      name: IdentifyCommand
      title: Identify
      payload:
        type: object
        properties:
          action:
            const: identify
            description: Request device identification.

    EnableCommand:
      name: EnableCommand
      title: Enable
      payload:
        type: object
        properties:
          action:
            const: enable
            description: Enable the coin changer.

    DisableCommand:
      name: DisableCommand
      title: Disable
      payload:
        type: object
        properties:
          action:
            const: disable
            description: Disable the coin changer.

    SpendCommand:
      name: SpendCommand
      title: Spend
      payload:
        type: object
        properties:
          action:
            const: spend
          X:
            type: number
            description: Amount to spend or dispense.

    DispenseCommand:
      name: DispenseCommand
      title: Dispense
      payload:
        type: object
        properties:
          action:
            const: dispense
          X:
            type: integer
            description: Coin type.
          Y:
            type: integer
            description: Quantity of coins.

    ConfigureCoinCommand:
      name: ConfigureCoinCommand
      title: ConfigureCoin
      payload:
        type: object
        properties:
          action:
            const: configureCoin
          X:
            type: integer
            description: Coin type.
          Y:
            type: integer
            description: Enable accept (0 or 1).
          Z:
            type: integer
            description: Enable manual dispense (0 or 1).

    ConfigureFeaturesCommand:
      name: ConfigureFeaturesCommand
      title: ConfigureFeatures
      payload:
        type: object
        properties:
          action:
            const: configureFeatures
          X:
            type: integer
            description: Enable value dispense (0 or 1).
          Y:
            type: integer
            description: Enable extended diagnostics (0 or 1).
          Z:
            type: integer
            description: Enable manual fill & payout (0 or 1).

    WsMessage:
      name: WsMessage
      title: CoinChangerEvent
      payload:
        type: object
        properties:
          short:
            type: string
          raw:
            type: string
          type:
            type: string
            enum: [RAW]
          value:
            type: string
          totalDeposited:
            type: number
          disabled:
            type: boolean
